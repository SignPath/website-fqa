<!-- last_modified_at:  --><!DOCTYPE html>
<html lang="en" data-appurl='https://fqa.test.signpath.io'>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href='https://signpath.github.io/website-staging//documentation/crypto-providers/macos' />
  <!-- Begin Jekyll SEO tag v2.6.1 -->
  <link rel='preload' as='style' href='/assets/css/line-awesome.min.css' onload="this.rel='stylesheet'">
  <title>Crypto Providers - macOS CryptoTokenKit | SignPath</title>
  <meta property="og:title" content="Crypto Providers - macOS CryptoTokenKit | SignPath" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:description" content="SignPath macOS CryptoTokenKit Crypto Provider" />
  <meta property="og:url" content="https://signpath.github.io/website-staging//documentation/crypto-providers/macos" />
  <meta property="og:site_name" content="SignPath - Code Signing Simple and Secure" />
  <meta name="description" content="SignPath macOS CryptoTokenKit Crypto Provider"/>
  <!-- End Jekyll SEO tag -->
  <link rel='stylesheet' href='/assets/css/hint.min.css'>
  <link rel="stylesheet" href="/assets/css/index.css?cache=2024-02-22">
  <link rel="alternate" type="application/atom+xml" title="SignPath.io Blog" href="/feed.xml">
  <script src='/assets/index.js?cache=2024-03-07'></script>
  <script src='/assets/js/main-bundle.js?cache=2024-08-05'></script><link rel="icon" href="/assets/favicon-50x50.png" sizes="32x32">
  <link rel="icon" href="/assets/favicon.png" sizes="192x192">
  <link rel="apple-touch-icon-precomposed" href="/assets/favicon.png">
  <meta name="msapplication-TileImage" content="/assets/favicon.png">
</head>
<body>
  <header>
    <div>
      <a href='/'><img src='/assets/signpath-logo-white.svg' width="181" height="36" alt='SignPath'></a>
      <nav>
        <ul><li>
              <a href='/product'> Product </a>
              <ul><li> <a href='/product/features'> Features </a> </li><li> <a href='/product/editions'> Editions </a> </li><li class='separator' /><li> <a href='/product/devops'> For DevOps teams </a> </li><li> <a href='/product/infosec'> For InfoSec teams </a> </li><li> <a href='/product/open-source'> For Open Source projects </a> </li><li class='separator' /><li> <a href='/product/office-macros'> Office macro signing </a> </li><li> <a href='/product/thales-dpod'> Thales DPoD Cloud HSM </a> </li><li> <a href='/product/pkic-best-practices'> PKI Consortium best practices </a> </li></ul>
            </li><li>
              <a href='/code-signing'> Code Signing </a>
              <ul><li> <a href='/code-signing/introduction'> Introduction </a> </li><li> <a href='/code-signing/theory'> Theory </a> </li><li> <a href='/code-signing/windows-platform'> Windows Platform </a> </li><li> <a href='/code-signing/test-certificates'> Managing Test Certificates </a> </li><li> <a href='/code-signing/private-keys'> Storage of Private Keys </a> </li><li> <a href='/code-signing/media-coverage'> Media Coverage </a> </li></ul>
            </li><li>
              <a href='/documentation'> Documentation </a>
              <ul><li> <a href='/documentation/getting-started'> Getting Started </a> </li><li> <a href='/documentation/managing-certificates'> Managing Certificates </a> </li><li> <a href='/documentation/users'> Managing Users </a> </li><li> <a href='/documentation/projects'> Setting up Projects </a> </li><li> <a href='/documentation/signing-code'> Signing Code </a> </li><li> <a href='/documentation/signing-containers'> Signing Container Images </a> </li><li class='separator' /><li> <a href='/documentation/artifact-configuration'> Artifact Configuration </a> </li><li> <a href='/documentation/build-system-integration'> Build System Integration </a> </li><li> <a href='/documentation/trusted-build-systems'> Trusted Build Systems </a> </li><li> <a href='/documentation/origin-verification'> Origin Verification </a> </li><li class='separator' /><li> <a href='/documentation/powershell'> PowerShell cmdlets </a> </li><li> <a href='/documentation/crypto-providers'> Crypto Providers </a> </li><li class='separator' /><li> <a href='/documentation/changelog'> Product updates </a> </li></ul>
            </li><li>
              <a href='/about-us'> About us </a>
              <ul><li> <a href='/company'> Company </a> </li><li> <a href='/team'> Team </a> </li><li> <a href='/blog'> Blog </a> </li><li> <a href='/jobs'> Jobs </a> </li><li> <a href='/support'> Support </a> </li><li> <a href='/contact'> Contact </a> </li></ul>
            </li><li class='login'><a class='btn btn-flat' href='https://fqa.test.signpath.io/Web/Home/Login'>Login</a>
          <li class='login'><a href='https://fqa.test.signpath.io/Web/Subscription/StartFreeTrial' class='btn btn-primary trial'>Start free trial</a></li>
          </li>
        </ul>
        <a id='main-menu-toggle' href='#' onclick='document.querySelector("header > div > nav > ul").classList.toggle("open")'>
          <div></div>
          <div></div>
          <div></div>
        </a>
      </nav>
    </div>
  </header>
  <main>
<section class="bg-blue font-white top-section">
	<div>
		<h1><span class='no-break'>Crypto Providers &nbsp;❯&nbsp; </span> macOS CryptoTokenKit</h1>
	</div>
</section>
<section class="resources-section">
	<div><aside>
				<ul><li class=''>
							<a href='/documentation/crypto-providers/#'>Crypto Providers</a></li><li class=''>
							<a href='/documentation/crypto-providers/windows#'>Windows CSP and KSP</a></li><li class=''>
							<a href='/documentation/crypto-providers/cryptoki#'>Cryptoki/PKCS#11</a></li><li class=''>
							<a href='/documentation/crypto-providers/gpg#'>GPG</a></li><li class='active'>
							<a href='/documentation/crypto-providers/macos#'>macOS CryptoTokenKit</a><div class="no-mobile" ><ul>
  <li><a href="#general-instructions">General instructions</a></li>
  <li><a href="#codesign">codesign</a></li>
  <li><a href="#productsign">productsign</a></li>
</ul>
</div></li><li class=''>
							<a href='/documentation/crypto-providers/rest-api#'>REST API</a></li></ul>
			</aside><article><ul class="article-toc">
  <li><a href="#general-instructions">General instructions</a>
    <ul>
      <li><a href="#supported-versions">Supported versions</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#usage">Usage</a></li>
      <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
  </li>
  <li><a href="#codesign">codesign</a></li>
  <li><a href="#productsign">productsign</a></li>
</ul>
<h2 id="general-instructions">General instructions</h2>

<p>This section provides information to use SignPath with any tool that supports macOS CryptoTokenKit.</p>

<h3 id="supported-versions">Supported versions</h3>

<p>macOS 11.0 or higher</p>

<h3 id="installation">Installation</h3>

<p>Simply copy-deploy the <code class="language-plaintext highlighter-rouge">SignPathCryptoTokenKit.app</code> application to the target system.</p>

<h3 id="background">Background</h3>

<p>macOS allows CryptoTokenKit extensions to be registered in the system. Through these extensions, key material and certificates can be provided. An extension is only available while the application that provides the extension is running. Therefore, before calling signing tools like <code class="language-plaintext highlighter-rouge">codesign</code>, the <code class="language-plaintext highlighter-rouge">SignPathCryptoTokenKit.app</code> needs to be started.</p>

<h3 id="usage">Usage</h3>

<p>The <code class="language-plaintext highlighter-rouge">SignPathCryptoTokenKit.app</code> application loads all available certificates for the given parameters and makes them avaialble in the macOS keychain through a CryptoTokenKit extension. The application supports the following parameters (all of them are optional):</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-config</code></td>
      <td><code class="language-plaintext highlighter-rouge">/path/to/config/file.json</code></td>
      <td>Path to config file</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-s</code></td>
      <td><code class="language-plaintext highlighter-rouge">$SigningPolicySlug</code></td>
      <td>If not specified, the certificates from all available signing policies will be loaded</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-p</code></td>
      <td><code class="language-plaintext highlighter-rouge">$ProjectSlug</code></td>
      <td>If not specified, the certificates from all available projects will be loaded</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-u</code></td>
      <td><code class="language-plaintext highlighter-rouge">$ApiUrl</code></td>
      <td>The base URL of the SignPath API, e.g. <code class="language-plaintext highlighter-rouge">https://app.signpath.io/Api</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-o</code></td>
      <td><code class="language-plaintext highlighter-rouge">$OrganizationId</code></td>
      <td>The id of the organization to use</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-t</code></td>
      <td><code class="language-plaintext highlighter-rouge">$ApiToken</code></td>
      <td>The API token for a CI or Interactive User (can be created in the “Users and Groups” UI)</td>
    </tr>
  </tbody>
</table>

<blockquote class="panel info">
  <p><strong>Keys are not specified directly</strong></p>

  <p>When using a file-based <a href="/documentation/crypto-providers#crypto-provider-configuration">configuration</a>, the macOS CryptoTokenKit Crypto Provider requires the config file to be</p>
  <ul>
    <li>named <code class="language-plaintext highlighter-rouge">config.json</code> and placed in the same directory as the <code class="language-plaintext highlighter-rouge">SignPathCryptoTokenKit.app</code> application or</li>
    <li>its path to be specified via the <code class="language-plaintext highlighter-rouge">-config</code> parameter</li>
  </ul>
</blockquote>

<p>Example call starting the application:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">SIGNPATH_API_TOKEN</span><span class="o">=</span>...
open SignPathCryptoTokenKit.app <span class="nt">--args</span> <span class="se">\</span>
  <span class="nt">-p</span> MyProject <span class="se">\</span>
  <span class="nt">-s</span> release-signing <span class="se">\</span>
  <span class="nt">-u</span> https://app.signpath.io/Api <span class="se">\</span>
  <span class="nt">-o</span> 0241f767-69c8-448d-ad5e-8bd453916068
</code></pre></div></div>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>The following commands are helpful to make sure the setup is correct:</p>

<p>Using the <code class="language-plaintext highlighter-rouge">security</code> command, the registered smart cards can be listed. This list should contain an entry <code class="language-plaintext highlighter-rouge">io.signpath.apps.SignPathCryptoTokenKit.ctk:&lt;identifier&gt;</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>security list-smartcard
</code></pre></div></div>

<p>Using the <code class="language-plaintext highlighter-rouge">pluginkit</code> tool, the registration of the token driver can be verified. The command lists all registered tokens and should also list <code class="language-plaintext highlighter-rouge">io.signpath.apps.CryptoTokenKit($Version)</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pluginkit <span class="nt">-m</span> <span class="nt">-v</span> <span class="nt">-p</span> com.apple.ctk-tokens
</code></pre></div></div>

<blockquote class="panel info">
  <p><strong>Info: Updated intermediate certificate</strong></p>

  <p>When creating a certificate in the Apple Developer portal, the intermediate certificate can be selected. On some machines, the new intermediate certificate is still missing. You can download it <a href="https://www.apple.com/certificateauthority/DeveloperIDG2CA.cer">here</a>.</p>
</blockquote>

<blockquote class="panel warning">
  <p><strong>Warning: Produce correct timestamps</strong></p>

  <p>When using codesign (or any other signing tool) directly, you are responsible for correct time stamping. See <a href="/documentation/crypto-providers#timestamps">Timestamps</a></p>
</blockquote>

<h2 id="codesign">codesign</h2>

<p><em><a href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/CodeSigningGuide/Procedures/Procedures.html">codesign</a></em> is a command line tool by Apple.</p>

<p><em>codesign</em> requires the following parameter to find the correct certificate:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">-s</code></td>
      <td><code class="language-plaintext highlighter-rouge">$SigningIdentity</code></td>
      <td>A descriptor of the code signing identity that is stored in the keychain by the SignPath CryptoTokenKit. Provide the common name (or a substring) of the certificate.</td>
    </tr>
  </tbody>
</table>

<p>Sample: sign <code class="language-plaintext highlighter-rouge">MyApp.app</code></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">codesign</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">MyCertificateSubjectName</span><span class="w"> </span><span class="nx">MyApp.app</span><span class="w">
</span></code></pre></div></div>

<h2 id="productsign">productsign</h2>

<p><em>productsign</em> is a command line tool by Apple.</p>

<p><em>productsign</em> requires the following parameter to find the correct certificate:</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">--sign</code></td>
      <td><code class="language-plaintext highlighter-rouge">$SigningIdentity</code></td>
      <td>A descriptor of the code signing identity that is stored in the keychain by the SignPath CryptoTokenKit. Provide the common name (or a substring) of the certificate.</td>
    </tr>
  </tbody>
</table>

<p>Sample: sign <code class="language-plaintext highlighter-rouge">MyInstaller.pkg</code></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">productsign</span><span class="w"> </span><span class="nt">--timestamp</span><span class="w"> </span><span class="nt">--sign</span><span class="w"> </span><span class="s2">"XX6NBJ3UUF"</span><span class="w"> </span><span class="nx">MyInstaller.pkg</span><span class="w"> </span><span class="nx">MyInstaller-signed.pkg</span><span class="w">
</span></code></pre></div></div>

<blockquote class="panel info">
  <p><strong>Info: using the right certificate</strong></p>

  <p><code class="language-plaintext highlighter-rouge">productsign</code> requires an “Apple Developer Installer” certificate.</p>
</blockquote>

		</article>
	</div>
</section><!-- last_modified_at:  --><section class='bg-dark-grey font-white newsletter' id="newsletter">
	<div>
		<h2>Sign up for news and special offers</h2>
		<form class="ml-block-form" action="https://app.mailerlite.com/webforms/submit/d7c3i1" data-code="d7c3i1" method="post">
			<input type="text" class="form-control" data-inputmask="" name="fields[name]" value="" placeholder="Name">
			<input type="email" class="form-control" data-inputmask="" name="fields[email]" value="" placeholder="Email">
			<input type="hidden" name="ml-submit" value="1">
			<button type="submit" class="btn btn-secondary newsletter">Subscribe</button>
		</form>
	</div>
</section>
</main>
  <footer>
  	<div>
	  	<div>
	  		<img src='/assets/signpath-logo-white.svg' width="334" height="67" alt='SignPath'/>
	  		<svg viewBox="0 0 244 18">
			  <text x="0" y="15">CODE SIGNING SIMPLE &amp; SECURE</text>
			</svg>
	  		<div>
				<a target="_blank" href="https://www.linkedin.com/company/33243108" rel="noopener noreferrer">
<svg class="icon footer" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="currentColor"  d="M 8.6425781 4 C 7.1835781 4 6 5.181625 6 6.640625 C 6 8.099625 7.182625 9.3085938 8.640625 9.3085938 C 10.098625 9.3085938 11.283203 8.099625 11.283203 6.640625 C 11.283203 5.182625 10.101578 4 8.6425781 4 z M 21.535156 11 C 19.316156 11 18.0465 12.160453 17.4375 13.314453 L 17.373047 13.314453 L 17.373047 11.310547 L 13 11.310547 L 13 26 L 17.556641 26 L 17.556641 18.728516 C 17.556641 16.812516 17.701266 14.960938 20.072266 14.960938 C 22.409266 14.960937 22.443359 17.145609 22.443359 18.849609 L 22.443359 26 L 26.994141 26 L 27 26 L 27 17.931641 C 27 13.983641 26.151156 11 21.535156 11 z M 6.3632812 11.310547 L 6.3632812 26 L 10.923828 26 L 10.923828 11.310547 L 6.3632812 11.310547 z"/></svg></a>
				&nbsp;&nbsp;
				<a target="_blank" href="mailto:info@signpath.io" rel="noopener noreferrer"><svg class="icon footer" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="currentColor" d="M 3 8 L 3 26 L 29 26 L 29 8 Z M 7.3125 10 L 24.6875 10 L 16 15.78125 Z M 5 10.875 L 15.4375 17.84375 L 16 18.1875 L 16.5625 17.84375 L 27 10.875 L 27 24 L 5 24 Z"/></svg>
</div>
	  	</div>
	  	<div>
	  		<a href='/privacy-policy'>Privacy Policy</a>
	  		<a href='/terms-of-service'>Terms of Service</a>
	  		<a href='/status'><span style="color: lightgreen;"><svg class="icon small" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="currentColor" d="M 28.28125 6.28125 L 11 23.5625 L 3.71875 16.28125 L 2.28125 17.71875 L 10.28125 25.71875 L 11 26.40625 L 11.71875 25.71875 L 29.71875 7.71875 Z"/></svg>
</span>Status
			</a>
	  	</div>
	</div>
  </footer>
        <div id='cookie-info'>
            <h3>Cookie settings</h3>
            <div class="container">
                <span>We use cookies to enhance your browsing experience.</span>
                <p class="mobile show-more active"><a>Show more information</a></p>
                <p class="mobile show-less"><a>Show less information</a></p>
                <span class="information">By clicking the “Accept” button below, you agree that non-essential cookies on our website may be used by us and by third parties, some of them located in the USA. Learn more about our cookies in our <a
                            href='/privacy-policy'>Privacy
					Policy</a>
                </span>
				<div class="actions">
					<button class='btn btn-primary' id='acknowledge-cookies-btn'>Accept</button>
					<button class="btn btn-grey" id='refuse-cookies-btn'>Refuse</button>
				</div>
            </div>
			<script>
				const queryString = window.location.search;
				const urlParams = new URLSearchParams(queryString);
				const adgroupid = urlParams.get('adgroupid') ? urlParams.get('adgroupid') : document.cookie.match('(^|;)\\s*' + 'adgroupid' + '\\s*=\\s*([^;]+)')?.pop() || ''

				if (adgroupid) {
					const els_trial = document.querySelectorAll("a[href='" + window.location.protocol + '//' + window.location.hostname + '/Web/Subscription/StartFreeTrial' + "']")
					const els_login = document.querySelectorAll("a[href='" + window.location.protocol + '//' + window.location.hostname + '/Web/Home/Login' + "']");

					for (let child of els_trial) {
						if (child.tagName === 'A') {
							child.href = child.href + '?websiteCorrelationId=' + adgroupid
						}
					}

					for (let child of els_login) {
						if (child.tagName === 'A') {
							child.href = child.href + '?websiteCorrelationId=' + adgroupid
						}
					}
				}
			</script>
		</div>
	</footer>
</body>
</html>
